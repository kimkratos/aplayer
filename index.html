<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>Music Visualizer</title>
    <link rel="stylesheet" href="https://unpkg.com/aplayer/dist/APlayer.min.css">
    <style>
        /* 居中容器样式 */
        body, html {
            height: 100%;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            background: #1a1a1a;
            color: #fff;
            font-family: Arial, sans-serif;
        }
        #player1 {
            width: 800px; /* 设置播放器的宽度 */
            margin-top: 20px;
        }
        .animation-container {
            position: relative;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            margin-top: 20px;
        }
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>

<div id="player1" class="aplayer"></div>
<div class="animation-container" id="animation-container">
    <canvas id="canvas"></canvas>
</div>

<script src="https://unpkg.com/aplayer/dist/APlayer.min.js"></script>
<script>
    const ap = new APlayer({
        container: document.getElementById('player1'),
        fixed: true,
        autoplay: true,
        theme: '#FADFA3',
        loop: 'all',  // 循环播放
        order: 'list',  // 列表顺序播放
        preload: 'auto',
        volume: 0.7,
        mutex: true,
        listFolded: false,  // 展开播放列表
        listMaxHeight: 90,
        lrcType: 3,
        audio: [
            {
                name: 'Pink Palaka',
                artist: 'Andrew E',
                url: '/music/PinkPalaka.m4a',
                cover: '/music/pink.png',
                lrc: '/music/pink.lrc'
            },
            {
                name: 'Ferrari',
                artist: 'Bebe Rexha',
                url: '/music/ferrari.m4a',
                cover: '/music/ferrari.png',
                lrc: '/music/ferrari.lrc'
            },
            {
                name: '霜雪千年',
                artist: '洛天依/乐正绫',
                url: '/music/sxqn.m4a',
                cover: '/music/sxqn.png',
                lrc: '/music/sxqn.lrc'
            },
            {
                name: 'jar of love',
                artist: '曲婉婷',
                url: '/music/ajar_Of_Love.m4a',
                cover: '/music/jar.png',
                lrc: '/music/jaroflove.lrc'
            },
            {
                name: '差不多先生',
                artist: 'hot dog',
                url: '/music/almostnew.m4a',
                cover: '/music/almost.png',
                lrc: '/music/almost.lrc'
            },
            {
                name: '垃圾话',
                artist: 'GAI',
                url: '/music/trash_talk_GAI.m4a',
                cover: '/music/trash.png',
                lrc: '/music/trash.lrc'
            },
            {
                name: '威远故事',
                artist: 'GAI',
                url: '/music/official_GAI.m4a',
                cover: '/music/offical.png',
                lrc: '/music/offical.lrc'
            },
        ]
    });

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const audio = ap.audio; // 使用 APlayer 播放器的音频元素

    canvas.width = canvas.clientWidth;
    canvas.height = canvas.clientHeight;

    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const audioSrc = audioContext.createMediaElementSource(audio);
    const analyser = audioContext.createAnalyser();

    audioSrc.connect(analyser);
    analyser.connect(audioContext.destination);
    analyser.fftSize = 256;

    const bufferLength = analyser.frequencyBinCount;
    const dataArray = new Uint8Array(bufferLength);

    const WIDTH = canvas.width;
    const HEIGHT = canvas.height;
    const centerX = WIDTH / 2;
    const centerY = HEIGHT / 2;
    const radius = 100;

    function draw() {
        requestAnimationFrame(draw);
        analyser.getByteFrequencyData(dataArray);

        ctx.clearRect(0, 0, WIDTH, HEIGHT);

        // 绘制透明的圆形外圈
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
        ctx.lineWidth = 2;
        ctx.stroke();

        // 绘制频谱条
        for (let i = 0; i < bufferLength; i++) {
            const angle = (i / bufferLength) * 2 * Math.PI;
            const barHeight = dataArray[i] / 2;
            const x = centerX + Math.cos(angle) * (radius + barHeight);
            const y = centerY + Math.sin(angle) * (radius + barHeight);

            ctx.beginPath();
            ctx.moveTo(centerX + Math.cos(angle) * radius, centerY + Math.sin(angle) * radius);
            ctx.lineTo(x, y);
            ctx.strokeStyle = `rgba(${dataArray[i]}, ${255 - dataArray[i]}, 150, 1)`;
            ctx.stroke();
        }
    }

    audio.onplay = () => {
        audioContext.resume().then(() => {
            draw();
        });
    };
</script>

</body>
</html>
